purpleair_api_key <- function(api_key = NULL, overwrite = FALSE, install = FALSE){
  if (!is.null(api_key)){
    if (api_key_checker(api_key) == T){
      if (install) {
        home <- Sys.getenv("HOME")
        renv <- file.path(home, ".Renviron")
        if (file.exists(renv)) {
          file.copy(renv, file.path(home, ".Renviron_backup_purpler"))
        }
        if (!file.exists(renv)) {
          file.create(renv)
        }
        else {
          if (isTRUE(overwrite)) {
            message("Your original .Renviron will be backed up and stored in your R HOME directory if needed.")
            oldenv = read.table(renv, stringsAsFactors = FALSE)
            newenv <- oldenv[-grep("PURPLEAIR_API_KEY", oldenv),
            ]
            write.table(newenv, renv, quote = FALSE, sep = "\n",
                        col.names = FALSE, row.names = FALSE)
          }
          else {
            tv <- readLines(renv)
            if (any(grepl("PURPLEAIR_API_KEY", tv))) {
              stop("A PURPLEAIR_API_KEY already exists. You can overwrite it with the argument overwrite=TRUE",
                   call. = FALSE)
            }
          }
        }
    keyconcat <- paste0("PURPLEAIR_API_KEY='", api_key, "'")
    write(keyconcat, renv, sep = "\n", append = TRUE)
    message("Your API key has been stored in your .Renviron and can be accessed by Sys.getenv(\"PURPLEAIR_API_KEY\"). \nTo use now, restart R or run `readRenviron(\"~/.Renviron\")`")
    return(api_key)
    }
    else {
      message("To install your API key for use in future sessions, run this function with `install = TRUE`.")
      Sys.setenv(PURPLEAIR_API_KEY = api_key)
    }
  }
  else {
    stop("Invalid API key. If you don't have an API key,")
  }
  }
  else {
    print(Sys.getenv("PURPLEAIR_API_KEY"))
  }
}
